/*
Leaflet.markercluster, Provides Beautiful Animated Marker Clustering functionality for Leaflet, a JS library for interactive maps.
https://github.com/Leaflet/Leaflet.markercluster
(c) 2012-2013, Dave Leaver, smartrak
*/(function(a,b,c){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,polygonOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null},addLayer:function(a){if(a instanceof L.LayerGroup){var b=[];for(var c in a._layers)b.push(a._layers[c]);return this.addLayers(b)}if(!a.getLatLng){this._nonPointGroup.addLayer(a);return this}if(!this._map){this._needsClustering.push(a);return this}if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(a,this._maxZoom);var d=a,e=this._map.getZoom();if(a.__parent)while(d.__parent._zoom>=e)d=d.__parent;this._currentShownBounds.contains(d.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(a,d):this._animationAddLayerNonAnimated(a,d));return this},removeLayer:function(a){if(!a.getLatLng){this._nonPointGroup.removeLayer(a);return this}if(!this._map){!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push(a);return this}if(!a.__parent)return this;this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a)),this._removeLayer(a,!0),this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),a.setOpacity&&a.setOpacity(1));return this},addLayers:function(a){var b,c,d,e=this._map,f=this._featureGroup,g=this._nonPointGroup;for(b=0,c=a.length;b<c;b++){d=a[b];if(!d.getLatLng){g.addLayer(d);continue}if(this.hasLayer(d))continue;if(!e){this._needsClustering.push(d);continue}this._addLayer(d,this._maxZoom);if(d.__parent&&d.__parent.getChildCount()===2){var h=d.__parent.getAllChildMarkers(),i=h[0]===d?h[1]:h[0];f.removeLayer(i)}}e&&(f.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()}),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds));return this},removeLayers:function(a){var b,c,d,e=this._featureGroup,f=this._nonPointGroup;if(!this._map){for(b=0,c=a.length;b<c;b++)d=a[b],this._arraySplice(this._needsClustering,d),f.removeLayer(d);return this}for(b=0,c=a.length;b<c;b++){d=a[b];if(!d.__parent){f.removeLayer(d);continue}this._removeLayer(d,!0,!0),e.hasLayer(d)&&(e.removeLayer(d),d.setOpacity&&d.setOpacity(1))}this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),e.eachLayer(function(a){a instanceof L.MarkerCluster&&a._updateIcon()});return this},clearLayers:function(){this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(a){delete a.__parent}),this._map&&this._generateInitialClusters();return this},getBounds:function(){var a=new L.LatLngBounds;if(this._topClusterLevel)a.extend(this._topClusterLevel._bounds);else for(var b=this._needsClustering.length-1;b>=0;b--)a.extend(this._needsClustering[b].getLatLng());var c=this._nonPointGroup.getBounds();c.isValid()&&a.extend(c);return a},eachLayer:function(a,b){var c=this._needsClustering.slice(),d;this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(c);for(d=c.length-1;d>=0;d--)a.call(b,c[d]);this._nonPointGroup.eachLayer(a,b)},hasLayer:function(a){if(!a)return!1;var b,c=this._needsClustering;for(b=c.length-1;b>=0;b--)if(c[b]===a)return!0;c=this._needsRemoving;for(b=c.length-1;b>=0;b--)if(c[b]===a)return!1;return!!a.__parent&&a.__parent._group===this||this._nonPointGroup.hasLayer(a)},zoomToShowLayer:function(a,b){var c=function(){if((a._icon||a.__parent._icon)&&!this._inZoomAnimation){this._map.off("moveend",c,this),this.off("animationend",c,this);if(a._icon)b();else if(a.__parent._icon){var d=function(){this.off("spiderfied",d,this),b()};this.on("spiderfied",d,this),a.__parent.spiderfy()}}};a._icon?b():a.__parent._zoom<this._map.getZoom()?(this._map.on("moveend",c,this),a._icon||this._map.panTo(a.getLatLng())):(this._map.on("moveend",c,this),this.on("animationend",c,this),this._map.setView(a.getLatLng(),a.__parent._zoom+1),a.__parent.zoomToBounds())},onAdd:function(a){this._map=a;var b,c,d;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";this._featureGroup.onAdd(a),this._nonPointGroup.onAdd(a),this._gridClusters||this._generateInitialClusters();for(b=0,c=this._needsRemoving.length;b<c;b++)d=this._needsRemoving[b],this._removeLayer(d,!0);this._needsRemoving=[];for(b=0,c=this._needsClustering.length;b<c;b++){d=this._needsClustering[b];if(!d.getLatLng){this._featureGroup.addLayer(d);continue}if(d.__parent)continue;this._addLayer(d,this._maxZoom)}this._needsClustering=[],this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),this._zoom=this._map.getZoom(),this._currentShownBounds=this._getExpandedVisibleBounds(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this),a.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),this._featureGroup.onRemove(a),this._nonPointGroup.onRemove(a),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(a){var b=a;while(b!==null&&!b._icon)b=b.__parent;return b},_arraySplice:function(a,b){for(var c=a.length-1;c>=0;c--)if(a[c]===b){a.splice(c,1);return!0}},_removeLayer:function(a,b,c){var d=this._gridClusters,e=this._gridUnclustered,f=this._featureGroup,g=this._map;if(b)for(var h=this._maxZoom;h>=0;h--)if(!e[h].removeObject(a,g.project(a.getLatLng(),h)))break;var i=a.__parent,j=i._markers,k;this._arraySplice(j,a);while(i){i._childCount--;if(i._zoom<0)break;b&&i._childCount<=1?(k=i._markers[0]===a?i._markers[1]:i._markers[0],d[i._zoom].removeObject(i,g.project(i._cLatLng,i._zoom)),e[i._zoom].addObject(k,g.project(k.getLatLng(),i._zoom)),this._arraySplice(i.__parent._childClusters,i),i.__parent._markers.push(k),k.__parent=i.__parent,i._icon&&(f.removeLayer(i),c||f.addLayer(k))):(i._recalculateBounds(),(!c||!i._icon)&&i._updateIcon()),i=i.__parent}delete a.__parent},_propagateEvent:function(a){a.layer instanceof L.MarkerCluster&&(a.type="cluster"+a.type),this.fire(a.type,a)},_defaultIconCreateFunction:function(a){var b=a.getChildCount(),c=" marker-cluster-";b<10?c+="small":b<100?c+="medium":c+="large";return new L.DivIcon({html:"<div><span>"+b+"</span></div>",className:"marker-cluster"+c,iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=this._map,b=this.options.spiderfyOnMaxZoom,c=this.options.showCoverageOnHover,d=this.options.zoomToBoundsOnClick;(b||d)&&this.on("clusterclick",this._zoomOrSpiderfy,this),c&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this),a.on("layerremove",this._hideCoverageOnRemove,this))},_zoomOrSpiderfy:function(a){var b=this._map;b.getMaxZoom()===b.getZoom()?this.options.spiderfyOnMaxZoom&&a.layer.spiderfy():this.options.zoomToBoundsOnClick&&a.layer.zoomToBounds()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&b.removeLayer(this._shownPolygon),a.layer.getChildCount()>2&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_hideCoverageOnRemove:function(a){a.layer===this&&this._hideCoverage()},_unbindEvents:function(){var a=this.options.spiderfyOnMaxZoom,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick,d=this._map;(a||c)&&this.off("clusterclick",this._zoomOrSpiderfy,this),b&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),d.off("zoomend",this._hideCoverage,this),d.off("layerremove",this._hideCoverageOnRemove,this))},_zoomEnd:function(){!this._map||(this._mergeSplitClusters(),this._zoom=this._map._zoom,this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,a),this._currentShownBounds=a;return}},_generateInitialClusters:function(){var a=this._map.getMaxZoom(),b=this.options.maxClusterRadius;this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1),this._maxZoom=a,this._gridClusters={},this._gridUnclustered={};for(var c=a;c>=0;c--)this._gridClusters[c]=new L.DistanceGrid(b),this._gridUnclustered[c]=new L.DistanceGrid(b);this._topClusterLevel=new L.MarkerCluster(this,-1)},_addLayer:function(a,b){var c=this._gridClusters,d=this._gridUnclustered,e,f;this.options.singleMarkerMode&&(a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}}));for(;b>=0;b--){e=this._map.project(a.getLatLng(),b);var g=c[b].getNearObject(e);if(g){g._addChild(a),a.__parent=g;return}g=d[b].getNearObject(e);if(g){var h=g.__parent;h&&this._removeLayer(g,!1);var i=new L.MarkerCluster(this,b,g,a);c[b].addObject(i,this._map.project(i._cLatLng,b)),g.__parent=i,a.__parent=i;var j=i;for(f=b-1;f>h._zoom;f--)j=new L.MarkerCluster(this,f,j),c[f].addObject(j,this._map.project(g.getLatLng(),f));h._addChild(j);for(f=b;f>=0;f--)if(!d[f].removeObject(g,this._map.project(g.getLatLng(),f)))break;return}d[b].addObject(a,e)}this._topClusterLevel._addChild(a),a.__parent=this._topClusterLevel;return},_mergeSplitClusters:function(){this._zoom<this._map._zoom?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,this._map._zoom)):this._zoom>this._map._zoom?(this._animationStart(),this._animationZoomOut(this._zoom,this._map._zoom)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds)return this.getBounds();var a=this._map,b=a.getBounds(),c=b._southWest,d=b._northEast,e=L.Browser.mobile?0:Math.abs(c.lat-d.lat),f=L.Browser.mobile?0:Math.abs(c.lng-d.lng);return new L.LatLngBounds(new L.LatLng(c.lat-e,c.lng-f,!0),new L.LatLng(d.lat+e,d.lng+f,!0))},_animationAddLayerNonAnimated:function(a,b){if(b===a)this._featureGroup.addLayer(a);else if(b._childCount===2){b._addToMap();var c=b.getAllChildMarkers();this._featureGroup.removeLayer(c[0]),this._featureGroup.removeLayer(c[1])}else b._updateIcon()}}),L.MarkerClusterGroup.include(L.DomUtil.TRANSITION?{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_animationZoomIn:function(a,b){var c=this,d=this._getExpandedVisibleBounds(),e=this._featureGroup,f;this._topClusterLevel._recursively(d,a,0,function(c){var g=c._latlng,h=c._markers,j;d.contains(g)||(g=null),c._isSingleParent()&&a+1===b?(e.removeLayer(c),c._recursivelyAddChildrenToMap(null,b,d)):(c.setOpacity(0),c._recursivelyAddChildrenToMap(g,b,d));for(f=h.length-1;f>=0;f--)j=h[f],d.contains(j._latlng)||e.removeLayer(j)}),this._forceLayout(),c._topClusterLevel._recursivelyBecomeVisible(d,b),e.eachLayer(function(a){!(a instanceof L.MarkerCluster)&&a._icon&&a.setOpacity(1)}),c._topClusterLevel._recursively(d,a,b,function(a){a._recursivelyRestoreChildPositions(b)}),setTimeout(function(){c._topClusterLevel._recursively(d,a,0,function(a){e.removeLayer(a),a.setOpacity(1)}),c._animationEnd()},200)},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a,this._getExpandedVisibleBounds())},_animationZoomOutSingle:function(a,b,c){var d=this._getExpandedVisibleBounds();a._recursivelyAnimateChildrenInAndAddSelfToMap(d,b+1,c);var e=this;this._forceLayout(),a._recursivelyBecomeVisible(d,c),setTimeout(function(){if(a._childCount===1){var f=a._markers[0];f.setLatLng(f.getLatLng()),f.setOpacity(1)}else a._recursively(d,c,0,function(a){a._recursivelyRemoveChildrenFromMap(d,b+1)});e._animationEnd()},200)},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a),b!==a&&(b._childCount>2?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.setOpacity(0),setTimeout(function(){d.removeLayer(a),a.setOpacity(1),c._animationEnd()},200)):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._map.getZoom())))},_forceLayout:function(){L.Util.falseFn(b.body.offsetWidth)}}:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds())},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}}),L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)},L.MarkerCluster=L.Marker.extend({initialize:function(a,b,c,d){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=a,this._zoom=b,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._bounds=new L.LatLngBounds,c&&this._addChild(c),d&&this._addChild(d)},getAllChildMarkers:function(a){a=a||[];for(var b=this._childClusters.length-1;b>=0;b--)this._childClusters[b].getAllChildMarkers(a);for(var c=this._markers.length-1;c>=0;c--)a.push(this._markers[c]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(){this._group._map.fitBounds(this._bounds)},getBounds:function(){var a=new L.LatLngBounds;a.extend(this._bounds);return a},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1);return this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._iconNeedsUpdate=!0,this._expandBounds(a),a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++),this.__parent&&this.__parent._addChild(a,!0)},_expandBounds:function(a){var b,c=a._wLatLng||a._latlng;a instanceof L.MarkerCluster?(this._bounds.extend(a._bounds),b=a._childCount):(this._bounds.extend(c),b=1),this._cLatLng||(this._cLatLng=a._cLatLng||c);var d=this._childCount+b;this._wLatLng?(this._wLatLng.lat=(c.lat*b+this._wLatLng.lat*this._childCount)/d,this._wLatLng.lng=(c.lng*b+this._wLatLng.lng*this._childCount)/d):this._latlng=this._wLatLng=new L.LatLng(c.lat,c.lng)},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,0,c-1,function(a){var c=a._markers,d,e;for(d=c.length-1;d>=0;d--)e=c[d],e._icon&&(e._setPos(b),e.setOpacity(0))},function(a){var c=a._childClusters,d,e;for(d=c.length-1;d>=0;d--)e=c[d],e._icon&&(e._setPos(b),e.setOpacity(0))})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c){this._recursively(a,c,0,function(d){d._recursivelyAnimateChildrenIn(a,d._group._map.latLngToLayerPoint(d.getLatLng()).round(),b),d._isSingleParent()&&b-1===c?(d.setOpacity(1),d._recursivelyRemoveChildrenFromMap(a,b)):d.setOpacity(0),d._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,0,b,null,function(a){a.setOpacity(1)})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,-1,b,function(d){if(b!==d._zoom)for(var e=d._markers.length-1;e>=0;e--){var f=d._markers[e];if(!c.contains(f._latlng))continue;a&&(f._backupLatlng=f.getLatLng(),f.setLatLng(a),f.setOpacity&&f.setOpacity(0)),d._group._featureGroup.addLayer(f)}},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=this._markers.length-1;b>=0;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(var d=this._childClusters.length-1;d>=0;d--)this._childClusters[d]._restorePosition();else for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c){var d,e;this._recursively(a,-1,b-1,function(a){for(e=a._markers.length-1;e>=0;e--){d=a._markers[e];if(!c||!c.contains(d._latlng))a._group._featureGroup.removeLayer(d),d.setOpacity&&d.setOpacity(1)}},function(a){for(e=a._childClusters.length-1;e>=0;e--){d=a._childClusters[e];if(!c||!c.contains(d._latlng))a._group._featureGroup.removeLayer(d),d.setOpacity&&d.setOpacity(1)}})},_recursively:function(a,b,c,d,e){var f=this._childClusters,g=this._zoom,h,i;if(b>g)for(h=f.length-1;h>=0;h--)i=f[h],a.intersects(i._bounds)&&i._recursively(a,b,c,d,e);else{d&&d(this),e&&this._zoom===c&&e(this);if(c>g)for(h=f.length-1;h>=0;h--)i=f[h],a.intersects(i._bounds)&&i._recursively(a,b,c,d,e)}},_recalculateBounds:function(){var a=this._markers,b=this._childClusters,c;this._bounds=new L.LatLngBounds,delete this._wLatLng;for(c=a.length-1;c>=0;c--)this._expandBounds(a[c]);for(c=b.length-1;c>=0;c--)this._expandBounds(b[c])},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.DistanceGrid=function(a){this._cellSize=a,this._sqCellSize=a*a,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),d=this._getCoord(b.y),e=this._grid,f=e[d]=e[d]||{},g=f[c]=f[c]||[],h=L.Util.stamp(a);this._objectPoint[h]=b,g.push(a)},updateObject:function(a,b){this.removeObject(a),this.addObject(a,b)},removeObject:function(a,b){var c=this._getCoord(b.x),d=this._getCoord(b.y),e=this._grid,f=e[d]=e[d]||{},g=f[c]=f[c]||[],h,i;delete this._objectPoint[L.Util.stamp(a)];for(h=0,i=g.length;h<i;h++)if(g[h]===a){g.splice(h,1),i===1&&delete f[c];return!0}},eachObject:function(a,b){var c,d,e,f,g,h,i,j=this._grid;for(c in j){g=j[c];for(d in g){h=g[d];for(e=0,f=h.length;e<f;e++)i=a.call(b,h[e]),i&&(e--,f--)}}},getNearObject:function(a){var b=this._getCoord(a.x),c=this._getCoord(a.y),d,e,f,g,h,i,j,k,l=this._objectPoint,m=this._sqCellSize,n=null;for(d=c-1;d<=c+1;d++){g=this._grid[d];if(g)for(e=b-1;e<=b+1;e++){h=g[e];if(h)for(f=0,i=h.length;f<i;f++)j=h[f],k=this._sqDist(l[L.Util.stamp(j)],a),k<m&&(m=k,n=j)}}return n},_getCoord:function(a){return Math.floor(a/this._cellSize)},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d}},function(){L.QuickHull={getDistant:function(a,b){var c=b[1].lat-b[0].lat,d=b[0].lng-b[1].lng;return d*(a.lat-b[0].lat)+c*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,b){var c=0,d=null,e=[],f,g,h;for(f=b.length-1;f>=0;f--){g=b[f],h=this.getDistant(g,a);if(h>0)e.push(g);else continue;h>c&&(c=h,d=g)}return{maxPoint:d,newPoints:e}},buildConvexHull:function(a,b){var c=[],d=this.findMostDistantPointFromBaseLine(a,b);if(d.maxPoint){c=c.concat(this.buildConvexHull([a[0],d.maxPoint],d.newPoints)),c=c.concat(this.buildConvexHull([d.maxPoint,a[1]],d.newPoints));return c}return[a]},getConvexHull:function(a){var b=!1,c=!1,d=null,e=null,f;for(f=a.length-1;f>=0;f--){var g=a[f];if(b===!1||g.lat>b)d=g,b=g.lat;if(c===!1||g.lat<c)e=g,c=g.lat}var h=[].concat(this.buildConvexHull([e,d],a),this.buildConvexHull([d,e],a));return h}}}(),L.MarkerCluster.include({getConvexHull:function(){var a=this.getAllChildMarkers(),b=[],c=[],d,e,f;for(f=a.length-1;f>=0;f--)e=a[f].getLatLng(),b.push(e);d=L.QuickHull.getConvexHull(b);for(f=d.length-1;f>=0;f--)c.push(d[f][0]);return c}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var a=this.getAllChildMarkers(),b=this._group,c=b._map,d=c.latLngToLayerPoint(this._latlng),e;this._group._unspiderfy(),this._group._spiderfied=this,a.length>=this._circleSpiralSwitchover?e=this._generatePointsSpiral(a.length,d):(d.y+=10,e=this._generatePointsCircle(a.length,d)),this._animationSpiderfy(a,e)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+a),d=c/this._2PI,e=this._2PI/a,f=[],g,h;f.length=a;for(g=a-1;g>=0;g--)h=this._circleStartAngle+g*e,f[g]=(new L.Point(b.x+d*Math.cos(h),b.y+d*Math.sin(h)))._round();return f},_generatePointsSpiral:function(a,b){var c=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,d=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,e=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,f=0,g=[],h;g.length=a;for(h=a-1;h>=0;h--)f+=d/c+h*5e-4,g[h]=(new L.Point(b.x+c*Math.cos(f),b.y+c*Math.sin(f)))._round(),c+=this._2PI*e/f;return g},_noanimationUnspiderfy:function(){var a=this._group,b=a._map,c=a._featureGroup,d=this.getAllChildMarkers(),e,f;this.setOpacity(1);for(f=d.length-1;f>=0;f--)e=d[f],c.removeLayer(e),e._preSpiderfyLatlng&&(e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng),e.setZIndexOffset&&e.setZIndexOffset(0),e._spiderLeg&&(b.removeLayer(e._spiderLeg),delete e._spiderLeg)}}),L.MarkerCluster.include(L.DomUtil.TRANSITION?{SVG_ANIMATION:function(){return b.createElementNS("http://www.w3.org/2000/svg","animate").toString().indexOf("SVGAnimate")>-1}(),_animationSpiderfy:function(a,c){var d=this,e=this._group,f=e._map,g=e._featureGroup,h=f.latLngToLayerPoint(this._latlng),i,j,k,l;for(i=a.length-1;i>=0;i--)j=a[i],j.setOpacity?(j.setZIndexOffset(1e6),j.setOpacity(0),g.addLayer(j),j._setPos(h)):g.addLayer(j);e._forceLayout(),e._animationStart();var m=L.Path.SVG?0:.3,n=L.Path.SVG_NS;for(i=a.length-1;i>=0;i--){l=f.layerPointToLatLng(c[i]),j=a[i],j._preSpiderfyLatlng=j._latlng,j.setLatLng(l),j.setOpacity&&j.setOpacity(1),k=new L.Polyline([d._latlng,l],{weight:1.5,color:"#222",opacity:m}),f.addLayer(k),j._spiderLeg=k;if(!L.Path.SVG||!this.SVG_ANIMATION)continue;var o=k._path.getTotalLength();k._path.setAttribute("stroke-dasharray",o+","+o);var p=b.createElementNS(n,"animate");p.setAttribute("attributeName","stroke-dashoffset"),p.setAttribute("begin","indefinite"),p.setAttribute("from",o),p.setAttribute("to",0),p.setAttribute("dur",.25),k._path.appendChild(p),p.beginElement(),p=b.createElementNS(n,"animate"),p.setAttribute("attributeName","stroke-opacity"),p.setAttribute("attributeName","stroke-opacity"),p.setAttribute("begin","indefinite"),p.setAttribute("from",0),p.setAttribute("to",.5),p.setAttribute("dur",.25),k._path.appendChild(p),p.beginElement()}d.setOpacity(.3);if(L.Path.SVG){this._group._forceLayout();for(i=a.length-1;i>=0;i--)j=a[i]._spiderLeg,j.options.opacity=.5,j._path.setAttribute("stroke-opacity",.5)}setTimeout(function(){e._animationEnd(),e.fire("spiderfied")},200)},_animationUnspiderfy:function(a){var b=this._group,c=b._map,d=b._featureGroup,e=a?c._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):c.latLngToLayerPoint(this._latlng),f=this.getAllChildMarkers(),g=L.Path.SVG&&this.SVG_ANIMATION,h,i,j;b._animationStart(),this.setOpacity(1);for(i=f.length-1;i>=0;i--){h=f[i];if(!h._preSpiderfyLatlng)continue;h.setLatLng(h._preSpiderfyLatlng),delete h._preSpiderfyLatlng,h.setOpacity?(h._setPos(e),h.setOpacity(0)):d.removeLayer(h),g&&(j=h._spiderLeg._path.childNodes[0],j.setAttribute("to",j.getAttribute("from")),j.setAttribute("from",0),j.beginElement(),j=h._spiderLeg._path.childNodes[1],j.setAttribute("from",.5),j.setAttribute("to",0),j.setAttribute("stroke-opacity",0),j.beginElement(),h._spiderLeg._path.setAttribute("stroke-opacity",0))}setTimeout(function(){var a=0;for(i=f.length-1;i>=0;i--)h=f[i],h._spiderLeg&&a++;for(i=f.length-1;i>=0;i--){h=f[i];if(!h._spiderLeg)continue;h.setOpacity&&(h.setOpacity(1),h.setZIndexOffset(0)),a>1&&d.removeLayer(h),c.removeLayer(h._spiderLeg),delete h._spiderLeg}b._animationEnd()},200)}}:{_animationSpiderfy:function(a,b){var c=this._group,d=c._map,e=c._featureGroup,f,g,h,i;for(f=a.length-1;f>=0;f--)i=d.layerPointToLatLng(b[f]),g=a[f],g._preSpiderfyLatlng=g._latlng,g.setLatLng(i),g.setZIndexOffset&&g.setZIndexOffset(1e6),e.addLayer(g),h=new L.Polyline([this._latlng,i],{weight:1.5,color:"#222"}),d.addLayer(h),g._spiderLeg=h;this.setOpacity(.3),c.fire("spiderfied")},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation?this._map.on("zoomstart",this._unspiderfyZoomStart,this):this._map.on("zoomend",this._unspiderfyWrapper,this),L.Path.SVG&&!L.Browser.touch&&this._map._initPathRoot()},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy()},_unspiderfyZoomStart:function(){!this._map||this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&(this._featureGroup.removeLayer(a),a.setOpacity(1),a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}})})(window,document)