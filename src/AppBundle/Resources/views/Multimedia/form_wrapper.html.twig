{% extends "BackendBundle:CRUD:create.html.twig" %}

{% block create_body %}
     {{ form_start(form) }}
     {{ form_row(form.title) }}
     {{ form_row(form.urlVideo) }}
     {{ form_row(form.fileVich, {'label': 'multimedia.form.file'|trans(), 'required': false}) }}
     {% if form.vars.errors is not null %}
         {% for error in form.vars.errors %}
             {% if error.messageTemplate == 'multimedia.file' %}
                 <span class="alert-danger">
                     {{ error.message }}
                 </span>
             {% endif %}
         {% endfor %}
     {% endif %}
     {% if entity.file is not null %}
         <div class="row">
             <div class="col-xs-4">
                 <a href="{{ files_path ~ '/' ~ entity.file }}" target="_blank" class="logo-image-preview img-responsive">{{ entity.file }}</a>
             </div>
         </div>
     {% endif %}
     {{ form_row(form.imageVich, {'label': 'multimedia.form.image'|trans()}) }}
     {% if entity.image is not null %}
         <div class="row">
             <div class="col-xs-4">
                 <img class="logo-image-preview img-responsive" src="{{ image_path ~ '/' ~ entity.image }}">
             </div>
         </div>
     {% endif %}
     {{ form_row(form.category) }}
     {{ form_row(form.submit) }}
     <div class="hide">
         {{ form_rest(form) }}
     </div>
     {{ form_end(form) }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        function validateYouTubeUrl()
        {
            var url = $('#appbundle_multimedia_urlVideo').val();
            if (url != undefined || url != '') {
                var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/;
                var match = url.match(regExp);
                if (match && match[2].length == 11) {
                    // Do anything for being valid
                    // if need to change the url to embed url then use below line
                    //$('#ytplayerSide').attr('src', 'https://www.youtube.com/embed/' + match[2] + '?autoplay=0');
                    $('form[name="appbundle_multimedia"]').submit();
                }
                else {
                    //alert('Por favor seleccione una url de youtube valida.');
                    $('#appbundle_multimedia_urlVideo').parent().addClass('has-error');
                    
                    var html ='<span class="help-block">    <ul class="list-unstyled"><li><span class="glyphicon glyphicon-exclamation-sign"></span> Url debe ser de youtube</li></ul></span>';
                    $('#appbundle_multimedia_urlVideo').parent().append(html);
                }
            }
        }
        
        $(document).ready(function(){
            $('#appbundle_multimedia_submit').click(function(e){
                e.preventDefault();
                validateYouTubeUrl(); 
            });
            {% if (edit is defined and edit) %}
                    $('#appbundle_multimedia_imageVich_file').removeAttr('required');
            {% endif %}
        });
        
    </script>
{% endblock %}